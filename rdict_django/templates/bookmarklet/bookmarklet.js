var Sly=(function(){var p={};var b=function(e){return p[e]||(p[e]=new b.initialize(e))};b.initialize=function(e){this.text=(typeof(e)=="string")?e.replace(/^\s+/,""):""};var s=b.initialize.prototype=b.prototype;b.implement=function(i,e){for(var B in e){b[i][B]=e[B]}};var c=b.features={querySelector:!!(document.querySelectorAll),elementsByClass:!!(document.getElementsByClassName)};var q=function(){return true};s.search=function(C,S){var E;if(!C){C=document}else{E=(C instanceof Array)}var J;if(c.querySelector&&!E&&C.nodeType==9){try{J=C.querySelectorAll(this.text)}catch(Q){}if(J){return b.toArray(J)}}var G=this.parse();var R,I={},F,K,B={},D={};var P=b.getUid;var T=function(i){var e=P(i);return(I[e])?null:(I[e]=true)};for(var O=0,N;(N=G[O]);O++){var H=T;if(N.first){if(!J){H=q}if(E){K=C}else{if(N.combinator){K=[C]}}}if(N.last&&J){I=B;F=J}else{I={};F=[]}if(!N.combinator){F=N.combine(F,C,N,D,H,!(F.length))}else{for(var M=0,L=K.length;M<L;M++){F=N.combine(F,K[M],N,D,H)}}if(N.last){if(F.length){J=F;R=true}}else{K=F}}if(S&&R&&J.length>1){if(document.compareDocumentPosition){J.sort(function(i,e){return(3-(i.compareDocumentPosition(e)&6))})}else{if(J[0].sourceIndex!=null){J.sort(function(i,e){return(i.sourceIndex-e.sourceIndex)})}}}return J||[]};s.find=function(e){return this.search(e)[0]};s.match=function(e){return !!(this.parse()[0].match(e,{}))};s.filter=function(e){var D=[],B=this.parse()[0].match;for(var C=0,E;(E=e[C]);C++){if(B(E)){D.push(E)}}return D};var y;b.recompile=function(){var i,e=[","],B=["!"];for(i in n){if(i!=" "){e[(i.length>1)?"unshift":"push"](b.escapeRegExp(i))}}for(i in u){B.push(i)}y=new RegExp("[\\w\\u00c0-\\uFFFF][\\w\\u00c0-\\uFFFF-]*|[#.][\\w\\u00c0-\\uFFFF-]+|[ \\t\\r\\n\\f](?=[\\w\\u00c0-\\uFFFF*#.[:])|("+e.join("|")+")[ \\t\\r\\n\\f]*|\\[([\\w\\u00c0-\\uFFFF-]+)(?:(["+B.join("")+"]?=)(?:\"([^\"]*)\"|'([^']*)'|([^\\]]*)))?]|:([-\\w\\u00c0-\\uFFFF]+)(?:\\((?:\"([^\"]*)\"|'([^']*)'|([^)]*))\\))?|\\*","g")};var l=function(e){return{ident:[],classes:[],attributes:[],pseudos:[],combinator:e}};var h=function(e){return e};s.parse=function(H){var D=(H)?"plain":"parsed";if(this[D]){return this[D]}var G=(H)?h:this.compute;var F=[],C=l(null);C.first=true;var E=function(I){F.push(G(C));C=l(I)};var B,i;while((B=y.exec(this.text))){i=B[0];switch(i.charAt(0)){case".":C.classes.push(i.slice(1));break;case"#":C.id=i.slice(1);break;case"[":C.attributes.push({name:B[2],operator:B[3]||null,value:B[4]||B[5]||B[6]||null});break;case":":C.pseudos.push({name:B[7],value:B[8]||B[9]||B[10]||null});break;case",":C.last=true;E(null);C.first=true;continue;case" ":case"\t":case"\r":case"\n":case"\f":B[1]=" ";default:var e=B[1];if(e){if(C.first&&!C.ident.length){C.combinator=e}else{E(e)}}else{if(i!="*"){C.tag=i}}}C.ident.push(i)}C.last=true;F.push(G(C));return(this[D]=F)};function t(B,i,e,C){var D=(B)?((C)?function(E,F){return i(E,e,F)&&B(E,F)}:function(E,F){return B(E,F)&&i(E,e,F)}):function(E,F){return i(E,e,F)};D.$slyIndex=(B)?(B.$slyIndex+1):0;return D}var k=function(){return true};var A=function(e,i){return(e.id==i)};var d=function(i,e){return(i.nodeName==e)};var j=function(e){return(new RegExp("(?:^|[ \\t\\r\\n\\f])"+e+"(?:$|[ \\t\\r\\n\\f])"))};var g=function(e,i){return e.className&&i.test(e.className)};var o=function(e){if(!e.operator||!e.value){return e}var i=u[e.operator];if(i){e.escaped=b.escapeRegExp(e.value);e.pattern=new RegExp(i(e.value,e.escaped,e))}return e};var r=function(i,e){var B=b.getAttribute(i,e.name);switch(e.operator){case null:return B;case"=":return(B==e.value);case"!=":return(B!=e.value)}if(!B&&e.value){return false}return e.pattern.test(B)};s.compute=function(F){var G,L,H,M,D,C,N=F.tag,B=F.id,E=F.classes;var I=(N)?N.toUpperCase():null;if(B){C=true;D=t(D,A,B);M=function(O){if(O.getElementById){var P=O.getElementById(B);return(P&&(!I||P.nodeName==I))?[P]:[]}var R=O.getElementsByTagName(N||"*");for(var i=0,Q;(Q=R[i]);i++){if(Q.id==B){return[Q]}}return[]}}if(E.length>0){if(!M&&b.features.elementsByClass){for(G=0;(L=E[G]);G++){D=t(D,g,j(L))}var K=E.join(" ");M=function(i){return i.getElementsByClassName(K)}}else{if(!M&&E.length==1){C=true;var J=j(E[0]);D=t(D,g,J);M=function(P){var S=P.getElementsByTagName(N||"*");var R=[];for(var O=0,Q;(Q=S[O]);O++){if(Q.className&&J.test(Q.className)){R.push(Q)}}return R}}else{for(G=0;(L=E[G]);G++){H=t(H,g,j(L))}}}}if(N){if(!M){D=t(D,d,I);M=function(i){return i.getElementsByTagName(N)}}else{if(!C){H=t(H,d,I)}}}else{if(!M){M=function(i){return i.getElementsByTagName("*")}}}for(G=0;(L=F.pseudos[G]);G++){if(L.name=="not"){H=t(H,function(O,i){return !i(O)},b(L.value).parse()[0].match)}else{var e=f[L.name];if(e){H=t(H,e,L.value)}}}for(G=0;(L=F.attributes[G]);G++){H=t(H,r,o(L))}if((F.simple=!(H))){F.matchAux=k}else{F.matchAux=H;D=t(D,H)}F.match=D||k;F.combine=b.combinators[F.combinator||" "];F.search=M;return F};var n=b.combinators={" ":function(G,C,F,e,J,I){var B=F.search(C);if(I&&F.simple){return b.toArray(B)}for(var H=0,E,D=F.matchAux;(E=B[H]);H++){if(J(E)&&D(E,e)){G.push(E)}}return G},">":function(E,D,e,H,F){var B=e.search(D);for(var C=0,G;(G=B[C]);C++){if(G.parentNode==D&&F(G)&&e.matchAux(G,H)){E.push(G)}}return E},"+":function(B,i,e,D,C){while((i=i.nextSibling)){if(i.nodeType==1){if(C(i)&&e.match(i,D)){B.push(i)}break}}return B},"~":function(B,i,e,D,C){while((i=i.nextSibling)){if(i.nodeType==1){if(!C(i)){break}if(e.match(i,D)){B.push(i)}}}return B}};var f=b.pseudos={"first-child":function(e){return f.index(e,0)},"last-child":function(e){while((e=e.nextSibling)){if(e.nodeType===1){return false}}return true},"only-child":function(B){var i=B;while((i=i.previousSibling)){if(i.nodeType===1){return false}}var e=B;while((e=e.nextSibling)){if(e.nodeType===1){return false}}return true},"nth-child":function(D,F,E){var i=b.parseNth(F||"n");if(i.special!="n"){return f[i.special](D,i.a,E)}E=E||{};E.positions=E.positions||{};var B=b.getUid(D);if(!E.positions[B]){var C=0;while((D=D.previousSibling)){if(D.nodeType!=1){continue}C++;var e=E.positions[b.getUid(D)];if(e!=undefined){C=e+C;break}}E.positions[B]=C}return(E.positions[B]%i.a==i.b)},empty:function(e){return !(e.innerText||e.textContent||"").length},contains:function(e,i){return(e.innerText||e.textContent||"").indexOf(i)!=-1},index:function(B,e){var i=0;while((B=B.previousSibling)){if(B.nodeType==1&&++i>e){return false}}return(i==e)},even:function(e,B,i){return f["nth-child"](e,"2n",i)},odd:function(e,B,i){return f["nth-child"](e,"2n+1",i)}};var u=b.operators={"*=":function(e,i){return i},"^=":function(e,i){return"^"+i},"$=":function(e,i){return e+"$"},"~=":function(e,i){return"(?:^|[ \\t\\r\\n\\f])"+i+"(?:$|[ \\t\\r\\n\\f])"},"|=":function(e,i){return"(?:^|\\|)"+i+"(?:$|\\|)"}};b.getAttribute=function(i,e){if(e=="class"){return i.className}return i.getAttribute(e,2)};var w=function(e){return Array.prototype.slice.call(e)};try{w(document.documentElement.childNodes)}catch(z){w=function(e){if(e instanceof Array){return e}var C=e.length,B=new Array(C);while(C--){B[C]=e[C]}return B}}b.toArray=w;var v=1;b.getUid=(window.ActiveXObject)?function(e){return(e.$slyUid||(e.$slyUid={id:v++})).id}:function(e){return e.$slyUid||(e.$slyUid=v++)};var m={};b.parseNth=function(C){if(m[C]){return m[C]}var B=C.match(/^([+-]?\d*)?([a-z]+)?([+-]?\d*)?$/);if(!B){return false}var i=parseInt(B[1],10),e=(parseInt(B[3],10)||0)-1;if((i=(isNaN(i))?1:i)){while(e<1){e+=i}while(e>=i){e-=i}}switch(B[2]){case"n":B={a:i,b:e,special:"n"};break;case"odd":B={a:2,b:0,special:"n"};break;case"even":B={a:2,b:1,special:"n"};break;case"first":B={a:0,special:"index"};break;case"last":B={special:"last-child"};break;case"only":B={special:"only-child"};break;default:B={a:(i)?(i-1):e,special:"index"}}return(m[C]=B)};b.escapeRegExp=function(e){return e.replace(/[-.*+?^${}()|[\]\/\\]/g,"\\$&")};b.generise=function(e){b[e]=function(B){var i=b(B);return i[e].apply(i,Array.prototype.slice.call(arguments,1))}};var a=["parse","search","find","match","filter"];for(var x=0;a[x];x++){b.generise(a[x])}b.recompile();return b})();

function get_selection() {
    var w=window,d=document,gS='getSelection';
    return (''+(w[gS]?w[gS]():d[gS]?d[gS]():d.selection.createRange().text)).replace(/(^\s+|\s+$)/g,'');
}
    
function rdict_open() {
    var q = "";
    var a = get_selection();

    inputs = Sly.search('input[type=text]');
    if (inputs.length > 0) {
        q = inputs[0].value;
    }
    
    postUrl = "http://{{ request.META.HTTP_HOST }}/bookmarklet/form?q=" + encodeURIComponent(q) + "&a=" + encodeURIComponent(a) + "&u=" + encodeURIComponent(document.location.href);
    postUrl = postUrl.replace(/"/g, '\\\"');

    html = '<div id="rdict" style="display:none;">'
    html+= '<iframe name="rdict_main" src="'+postUrl+'" width="0" height="0"></iframe>'
    html+= '</div>'
   
    rdict_hidden_div = document.getElementById('rdict_hidden_div');
    if (null == rdict_hidden_div) {
        rdict_hidden_div = document.createElement('DIV');
        rdict_hidden_div.id = 'rdict_hidden_div';
        document.body.appendChild(rdict_hidden_div);
    }
    rdict_hidden_div.innerHTML = html;
}

rdict_open();